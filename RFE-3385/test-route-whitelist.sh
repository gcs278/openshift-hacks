#!/bin/bash

oc apply -f - <<EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-sleeper
  labels:
    app: echo-sleeper
spec:
  replicas: 1
  selector:
    matchLabels:
      app: echo-sleeper
  template:
    metadata:
      labels:
        app: echo-sleeper
    spec:
      containers:
      - image: image-registry.openshift-image-registry.svc:5000/openshift/tools:latest
        name: echo-sleeper
        command:
        - /usr/bin/socat
        - TCP4-LISTEN:8676,reuseaddr,fork
        - EXEC:'/bin/bash -c \"sleep 1; printf \\\"HTTP/1.0 200 OK\r\n\r\n\\\"; sed -e \\\"/^\r/q\\\"\"'
        ports:
        - containerPort: 8676
          protocol: TCP
        dnsPolicy: ClusterFirst
        securityContext: {}
EOF

oc apply -f - <<EOF
apiVersion: v1
kind: Service
metadata:
  name: route-service1
  labels:
    app: echo-sleeper
spec:
  selector:
    app: echo-sleeper
  ports:
    - port: 8676
      name: echo-sleeper
      protocol: TCP
EOF

oc apply -f - <<EOF
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: router-service1
  annotations:
    haproxy.router.openshift.io/ip_whitelist: 10.1.0.0/16 10.2.0.0/16 10.3.0.0/16 10.4.0.0/16 10.5.0.0/16 10.6.0.0/16 10.7.0.0/16 10.8.0.0/16 10.9.0.0/16 10.10.0.0/16 10.11.0.0/16 10.12.0.0/16 10.13.0.0/16 10.14.0.0/16 10.15.0.0/16 10.16.0.0/16 10.17.0.0/16 10.18.0.0/16 10.19.0.0/16 10.20.0.0/16 10.21.0.0/16 10.22.0.0/16 10.23.0.0/16 10.24.0.0/16 10.25.0.0/16 10.26.0.0/16 10.27.0.0/16 10.28.0.0/16 10.29.0.0/16 10.30.0.0/16 10.31.0.0/16 10.32.0.0/16 10.33.0.0/16 10.34.0.0/16 10.35.0.0/16 10.36.0.0/16 10.37.0.0/16 10.38.0.0/16 10.39.0.0/16 10.40.0.0/16 10.41.0.0/16 10.42.0.0/16 10.43.0.0/16 10.44.0.0/16 10.45.0.0/16 10.46.0.0/16 10.47.0.0/16 10.48.0.0/16 10.49.0.0/16 10.50.0.0/16 10.51.0.0/16 10.52.0.0/16 10.53.0.0/16 10.54.0.0/16 10.55.0.0/16 10.56.0.0/16 10.57.0.0/16 10.58.0.0/16 10.59.0.0/16 10.60.0.0/16 10.61.0.0/16 10.62.0.0/16 10.63.0.0/16 10.64.0.0/16 10.65.0.0/16 10.66.0.0/16 10.67.0.0/16 10.68.0.0/16 10.69.0.0/16 10.70.0.0/16 10.71.0.0/16 10.72.0.0/16 10.73.0.0/16 10.74.0.0/16 10.75.0.0/16 10.76.0.0/16 10.77.0.0/16 10.78.0.0/16 10.79.0.0/16 10.80.0.0/16 10.81.0.0/16 10.82.0.0/16 10.83.0.0/16 10.84.0.0/16 10.85.0.0/16 10.86.0.0/16 10.87.0.0/16 10.88.0.0/16 10.89.0.0/16 10.90.0.0/16 10.91.0.0/16 10.92.0.0/16 10.93.0.0/16 10.94.0.0/16 10.95.0.0/16 10.96.0.0/16 10.97.0.0/16 10.98.0.0/16 10.99.0.0/16 10.100.0.0/16
    haproxy.router.openshift.io/ip_allowlist: 10.2.0.0/16 10.3.0.0/16 10.4.0.0/16 10.5.0.0/16 10.6.0.0/16 10.7.0.0/16 10.8.0.0/16 10.9.0.0/16 10.10.0.0/16 10.11.0.0/16 10.12.0.0/16 10.13.0.0/16 10.14.0.0/16 10.15.0.0/16 10.16.0.0/16 10.17.0.0/16 10.18.0.0/16 10.19.0.0/16 10.20.0.0/16 10.21.0.0/16 10.22.0.0/16 10.23.0.0/16 10.24.0.0/16 10.25.0.0/16 10.26.0.0/16 10.27.0.0/16 10.28.0.0/16 10.29.0.0/16 10.30.0.0/16 10.31.0.0/16 10.32.0.0/16 10.33.0.0/16 10.34.0.0/16 10.35.0.0/16 10.36.0.0/16 10.37.0.0/16 10.38.0.0/16 10.39.0.0/16 10.40.0.0/16 10.41.0.0/16 10.42.0.0/16 10.43.0.0/16 10.44.0.0/16 10.45.0.0/16 10.46.0.0/16 10.47.0.0/16 10.48.0.0/16 10.49.0.0/16 10.50.0.0/16 10.51.0.0/16 10.52.0.0/16 10.53.0.0/16 10.54.0.0/16 10.55.0.0/16 10.56.0.0/16 10.57.0.0/16 10.58.0.0/16 10.59.0.0/16 10.60.0.0/16 10.61.0.0/16 10.62.0.0/16 10.63.0.0/16 10.64.0.0/16 10.65.0.0/16 10.66.0.0/16 10.67.0.0/16 10.68.0.0/16 10.69.0.0/16 10.70.0.0/16 10.71.0.0/16 10.72.0.0/16 10.73.0.0/16 10.74.0.0/16 10.75.0.0/16 10.76.0.0/16 10.77.0.0/16 10.78.0.0/16 10.79.0.0/16 10.80.0.0/16 10.81.0.0/16 10.82.0.0/16 10.83.0.0/16 10.84.0.0/16 10.85.0.0/16 10.86.0.0/16 10.87.0.0/16 10.88.0.0/16 10.89.0.0/16 10.90.0.0/16 10.91.0.0/16 10.92.0.0/16 10.93.0.0/16 10.94.0.0/16 10.95.0.0/16 10.96.0.0/16 10.97.0.0/16 10.98.0.0/16 10.99.0.0/16 10.100.0.0/16
spec:
  to:
    kind: Service
    name: route-service1
EOF
