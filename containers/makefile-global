ROOT_DIR:=$(shell dirname $(realpath $(firstword $(MAKEFILE_LIST))))
# Image values
REGISTRY := "quay.io"
PROJECT := ${USER}
IMAGE := $(shell basename ${ROOT_DIR})
TAG := "latest"
IMAGE_REF := $(REGISTRY)/$(PROJECT)/$(IMAGE):$(TAG)

# Choose docker if install, if not, use podman
ENGINE=$(shell command -v docker &> /dev/null && echo docker || echo podman)

# Default build and then push
default: all
all: build push

build:
	$(ENGINE) build -f Dockerfile -t $(IMAGE_REF) .

push:
	$(ENGINE) login $(REGISTRY)
	$(ENGINE) push $(IMAGE_REF)
